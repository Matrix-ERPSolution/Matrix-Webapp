<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userMapper">
	<select id="login" parameterType="java.util.Map" resultType="String">	
		select user_id from users where user_id=#{userId} and pw=#{pw}
	</select>
		
	<insert id="addUser" parameterType="com.itss.matrix.model.UserVO">
		insert into users 
		(user_id, pw, phone_num, name, birth, gender, email, address_city, address_gu, address_dong, status, profile_photo) 
		values ( #{userId}, #{pw}, #{phoneNum}, #{name}, #{birth}, #{gender}, #{email}, #{addressCity}, #{addressGu}, #{addressDong}, 1, #{profilePhoto})
	</insert>
	
	<insert id="addUserWithoutProfilePhoto" parameterType="com.itss.matrix.model.UserVO">
		insert into users 
		(user_id, pw, phone_num, name, birth, gender, email, address_city, address_gu, address_dong, status, profile_photo) 
		values ( #{userId}, #{pw}, #{phoneNum}, #{name}, #{birth}, #{gender}, #{email}, #{addressCity}, #{addressGu}, #{addressDong}, 1, null)
	</insert>
	
	<select id="isUserPhoneNum" parameterType="String" resultType="String">
		select phone_num from users where phone_num= #{phoneNum}
	</select>
	
	<select id="isUserId" parameterType="String" resultType="String">
		select user_id from users where user_id = #{userId}
	</select>
	
	<update id="setPw" parameterType="java.util.Map">
		update users set pw=#{newPw} where user_id=#{userId}
	</update>
	
	<select id="getUserPhoneNum" parameterType="String" resultType="String">
		select phone_num from users where user_id=#{userId}
	</select>
	
	<update id="setUserInfo"  parameterType="java.util.Map">
	update users 
	set birth=#{newBirth}, email=#{newEmail}, address_city=#{newAddressCity}, address_gu=#{newAddressGu}, address_dong=#{newAddressDong}, phone_num=#{newPhoneNum}, profile_photo=#{newProfilePhoto}
	where user_id=#{userId}
	</update>
	
	<update id="setUserInfoWithoutProfilePhoto" parameterType="java.util.Map">
	update users 
	set email=#{newEmail}, address_city=#{newAddressCity}, address_gu=#{newAddressGu}, address_dong=#{newAddressDong}, phone_num=#{newPhoneNum}, profile_photo=null
	where user_id=#{userId}
	</update>
	
	<select id="getUserInfo" parameterType="String" resultType="java.util.Map">
		select name, to_char(birth, 'yyyy/mm/dd') as birth, email, address_city, address_gu, address_dong, phone_num, profile_photo 
		from users 
		where user_id=#{userId}
	</select>
	
	<update id="setProfilePhoto"  parameterType="java.util.Map">
		update users set profile_photo=#{newProfilePhoto} where user_id=#{userId}
	</update>

	<select id="getAdminSlideInfo" parameterType="String" resultType="java.util.Map">
		select u.profile_photo, b.branch_name, u.name
		from users u, admins a, branches b
		where u.user_id= #{userId}
		and u.user_id=a.admin_id
		and a.branch_seq=b.branch_seq
	</select>

	<select id="getStaffSlideInfo" parameterType="String" resultType="java.util.Map">
		select u.profile_photo, b.branch_name, u.name
		from users u, staffs s, branches b
		where u.user_id= #{userId}
		and u.user_id=s.staff_id
		and s.branch_seq=b.branch_seq
	</select>
	
	<update id="removeUser"  parameterType="java.util.Map">
		update users set status=0 where user_id=#{userId} and pw=#{pw}
	</update>
	
	<select id="getUsers" resultType="String">
		select user_id
		from users
		where status=1
	</select>
	
	<select id="isCertifiedAdmin" parameterType="String" resultType="String">
		select branch_seq from admins where admin_id=#{userId}
	</select>
	
	<select id="isCertifiedStaff" parameterType="String" resultType="String">
		select branch_seq from staffs where staff_id=#{userId}
	</select>
	
</mapper>